@page "/contacts_old"
@rendermode InteractiveServer
@using Contato.Data.Models
@using Contato.Data
@using Microsoft.EntityFrameworkCore
@inject ContactDBContext db
@inject IJSRuntime JSRuntime



<h1>Gerenciamento de Contatos</h1>

<div>
    <button class="btn btn-primary" @onclick="() => OpenAddEditModal()">Adicionar Novo Contato</button>
</div>

<!-- Modal Bootstrap para adicionar/editar contatos -->
<div class="modal" id="contactModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">@modalTitle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <EditForm Model="currentContact" OnValidSubmit="SaveContact" FormName="ContactForm">
                    <DataAnnotationsValidator />
                    <ValidationSummary />

                    <div class="form-group">
                        <label for="name">Nome:</label>
                        <InputText id="name" class="form-control" @bind-Value="currentContact.Nome" />
                    </div>
                    <div class="form-group">
                        <label for="ddd">DDD:</label>
                        <InputText id="ddd" class="form-control" @bind-Value="currentContact.DDD" />
                    </div>
                    <div class="form-group">
                        <label for="phone">Telefone:</label>
                        <InputText id="phone" class="form-control" @bind-Value="currentContact.Telefone" />
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <InputText id="email" class="form-control" @bind-Value="currentContact.Email" />
                    </div>

                    <button type="submit" class="btn btn-success">Salvar</button>
                </EditForm>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>


@if (contatos == null)
{
    <p><em>Carregando...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Nome</th>
                <th>DDD</th>
                <th>Telefone</th>
                <th>Email</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var contato in contatos)
            {
                <tr>
                    <td>@contato.Nome</td>
                    <td>@contato.DDD</td>
                    <td>@contato.Telefone</td>
                    <td>@contato.Email</td>
                    <td>
                        <button class="btn btn-success" @onclick="() => OpenAddEditModal(contato)">Editar</button>
                        <button class="btn btn-danger" @onclick="() => ConfirmDelete(contato.Id)">Excluir</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    
}





@code {
    private List<Contact> contatos;
    private Contact currentContact = new Contact();
    private bool isEditMode;

    protected override async Task OnInitializedAsync()
    {
        contatos = await db.Contacts.ToListAsync();
    }


    private async Task SaveContact()
    {
        if (isEditMode)
        {
            db.Contacts.Update(currentContact);
        }
        else
        {
            db.Contacts.Add(currentContact);
        }

        await db.SaveChangesAsync();
        await OnInitializedAsync(); // Reload the list
    }

    private async Task ConfirmDelete(int id)
    {
        var contato = await db.Contacts.FindAsync(id);
        if (contato != null)
        {
            db.Contacts.Remove(contato);
            await db.SaveChangesAsync();
            await OnInitializedAsync(); // Reload the list
        }
    }
    private string modalTitle = "Adicionar Novo Contato";

    public void OpenAddEditModal(Contact contato = null)
    {
        currentContact = contato ?? new Contact();
        isEditMode = contato != null;
        modalTitle = isEditMode ? "Editar Contato" : "Adicionar Novo Contato";
        Console.WriteLine($"Modal Title: {modalTitle}");
        StateHasChanged();
        JSRuntime.InvokeVoidAsync("showContactModal");
    }

}

